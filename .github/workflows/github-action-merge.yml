name: Merge and notify
on:
  push:
    branches:
      - master
jobs:
  merge_and_notify:
    runs-on: ubuntu-latest
    steps:
      - name: 检出代码
        uses: actions/checkout@master

      - name: Merge master
        env:
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          pr_url=$(gh pr create --base test --head master --title "Action PR" --body "Action PR")
          pr_number=$(echo "$pr_url" | sed 's/.*\///')
          
          gh pr merge $pr_num --merge
          
          curl -X POST \
          -H "Content-Type: application/json" \
          -d '{
              "msg_type": "text",
              "content": {
                  "text": "'"${pr_num}"'"
              }
          }' \
          https://open.feishu.cn/open-apis/bot/v2/hook/f75f0d28-a103-43a6-a0dd-797b111b4498